function doGet() {
  // Get the Google Sheet by ID
  var sheetId = "1LHV8jSSsQ7TAc1Emi_888jliem003l2ys4EIEqMh_GQ";
  var sheetName = "book_sent";
  var sheet = SpreadsheetApp.openById(sheetId).getSheetByName(sheetName);
  
  // Get data from the sheet
  var data = sheet.getDataRange().getValues();

  // Separate the header and the data
  var header = data[0];
  var rows = data.slice(1);

  // Sort the data by column A (descending order)
  rows.sort((a, b) => b[0] - a[0]);

  // Format dates in column C
  var dateColumnIndex = 2; // Assuming column C is the third column (index starts at 0)
  rows = rows.map(row => {
    if (row[dateColumnIndex] instanceof Date) {
      // Format date to Thai format
      const year = row[dateColumnIndex].getFullYear() < 2500
        ? row[dateColumnIndex].getFullYear() + 543
        : row[dateColumnIndex].getFullYear();
      const thaiMonthNames = [
        "มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน", "พฤษภาคม", "มิถุนายน",
        "กรกฎาคม", "สิงหาคม", "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"
      ];
      row[dateColumnIndex] = `${row[dateColumnIndex].getDate()} ${thaiMonthNames[row[dateColumnIndex].getMonth()]} ${year}`;
    }
    return row;
  });

  // Generate HTML table with Bootstrap 5 styling
  var html = `
    <html>
    <head>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
      <style>
        body {
          font-family: 'Prompt', sans-serif;
          background-color: #f8f9fa;
          padding: 20px;
        }
        .table-container {
          background-color: #ffffff;
          padding: 20px;
          border-radius: 10px;
          box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .table th {
          background-color: #007bff;
          color: #ffffff;
        }
        .search-box {
          margin-bottom: 15px;
        }
      </style>
    </head>
    <body>
      <div class="container">
        <div class="table-container">
          <h2 class="mb-4">ระบบแสดงเลขหนังสือ</h2>
          <input type="text" id="searchBox" class="form-control search-box" placeholder="ค้นหาชื่อเรื่องหนังสือ" onkeyup="filterTable()" />
          <table id="dataTable" class="table table-bordered table-hover">
            <thead class="table-light">
              <tr>${header.map(h => `<th>${h}</th>`).join('')}</tr>
            </thead>
            <tbody>
              ${rows.map(row => `<tr>${row.map(cell => `<td>${cell}</td>`).join('')}</tr>`).join('')}
            </tbody>
          </table>
        </div>
      </div>
      <script>
        function filterTable() {
          var input = document.getElementById("searchBox");
          var filter = input.value.toLowerCase();
          var table = document.getElementById("dataTable");
          var tr = table.getElementsByTagName("tr");

          for (var i = 1; i < tr.length; i++) {
            var td = tr[i].getElementsByTagName("td")[5]; // Column F (index 5)
            if (td) {
              var txtValue = td.textContent || td.innerText;
              tr[i].style.display = txtValue.toLowerCase().indexOf(filter) > -1 ? "" : "none";
            }
          }
        }
      </script>
    </body>
    </html>
  `;
  
  // Return the HTML content
  return HtmlService.createHtmlOutput(html)
    .setTitle("Book Sent Data")
    .setWidth(800);
}
